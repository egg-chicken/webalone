!function t(e,r,n){function o(s,u){if(!r[s]){if(!e[s]){var a="function"==typeof require&&require;if(!u&&a)return a(s,!0);if(i)return i(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var h=r[s]={exports:{}};e[s][0].call(h.exports,function(t){var r=e[s][1][t];return o(r?r:t)},h,h.exports,t,e,r,n)}return r[s].exports}for(var i="function"==typeof require&&require,s=0;s<n.length;s++)o(n[s]);return o}({1:[function(t,e,r){window.Alone={Dungeon:t("./models/dungeon"),Storage:t("./models/storage"),Command:t("./models/dungeon/command/")}},{"./models/dungeon":2,"./models/dungeon/command/":23,"./models/storage":33}],2:[function(t,e,r){var n,o,i,s;s=t("./storage"),n=t("./dungeon/board_factory"),i=t("./dungeon/player/"),e.exports=o=function(){function t(){}var e;return e={PLAYING:0,COMPLETED:1,FAILED:2},t.prototype.setup=function(){return this.board=n.create(),this.boardStatus=e.PLAYING,this.user=new i.Human,this.user.setScore(s.getScore()),this.user.assign(this.board.getHero()),this.opponent=new i.Computer,this.opponent.assign(this.board.getEnemies())},t.prototype.getPlayer=function(){return this.user},t.prototype.round=function(){var t,r,n,o;for(o=[this.user,this.opponent],t=0,r=o.length;r>t&&(n=o[t],this.boardStatus===e.PLAYING);t++)this._turn(n);return this.isCompleted()?this._updateStorage():void 0},t.prototype.isCompleted=function(){return this.boardStatus===e.COMPLETED},t.prototype.isFailed=function(){return this.boardStatus===e.FAILED},t.prototype._turn=function(t){var r,n,o,i,s,u;for(s=t.characters(),u=[],o=0,i=s.length;i>o&&(r=s[o],this.boardStatus===e.PLAYING);o++)n=t.command(r,this.board.inspectBy(r)),n.perform(this.board),this._updateBoardStatus(t,n),t===this.user?u.push(this._addScore(n)):u.push(void 0);return u},t.prototype._updateBoardStatus=function(t,r){return r.isGameOver()?this.boardStatus=e.FAILED:r.isReached()&&t===this.user?this.boardStatus=e.COMPLETED:void 0},t.prototype._updateStorage=function(){return s.setScore(this.user.getScore()),s.setDifficulty(s.getDifficulty()+1)},t.prototype._addScore=function(t){return t.isDefeated()?this.user.addScoreByCharacter(t.getTarget()):t.isReached()?this.user.addScoreByBoard(1):void 0},t}()},{"./dungeon/board_factory":20,"./dungeon/player/":30,"./storage":33}],3:[function(t,e,r){var n,o,i,s,u;u=t("underscore"),n=t("utils/array2d"),s=t("./board/inspector"),i=t("./board/character_factory"),e.exports=o=function(){function t(t,e,r,n){this.land=t,this.characters=e,this.items=r,this.level=n}return t.prototype.getLevel=function(){return this.level},t.prototype.getHero=function(){return this.characters.getHero()},t.prototype.getEnemies=function(){return this.characters.getEnemies()},t.prototype.getCharacters=function(){return this.characters.getCharacters()},t.prototype.get=function(t){return this.characters.getByPosition(t)},t.prototype.getItem=function(t){return this.items.getByPosition(t)},t.prototype.getDoors=function(t){return this.land.getDoors(t)},t.prototype.isExit=function(t){return this.land.isExit(t)},t.prototype.isRoom=function(t){return this.land.isRoom(t)},t.prototype.isSameRoom=function(t,e){return this.land.isSameRoom(t,e)},t.prototype.isWall=function(t){return this.land.isWall(t)},t.prototype.remove=function(t){return this.characters.remove(t)||this.items.remove(t)},t.prototype.createOne=function(t){var e,r,n,o,s;for(s=this.land.getFreePositions(),r=0,n=s.length;n>r;r++)if(o=s[r],null==this.characters.getByPosition(o))return e=i.createByName(t),e.setPosition(o),this.characters.add(e);throw new Error("no free position on the board")},t.prototype.put=function(t,e){if(this.land.isWall(t))throw new Error("cannot put on the wall");if(this.get(t))throw new Error("character is already exist");return e.setPosition(t)},t.prototype.inspectBy=function(t){return new s(this,t)},t.prototype.to_s=function(){var t,e,r,o,i,s;for(t=new n(this.land.getWidth(),this.land.getHeight()),i=t.pairs(),e=0,r=i.length;r>e;e++)o=i[e],s=this.characters.getSymbol(o)||this.items.getSymbol(o)||this.land.getSymbol(o),t.set(o,s);return t.to_s()},t}()},{"./board/character_factory":8,"./board/inspector":9,underscore:36,"utils/array2d":34}],4:[function(t,e,r){var n,o,i,s,u=function(t,e){function r(){this.constructor=t}for(var n in e)a.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},a={}.hasOwnProperty;s=t("underscore"),i=t("./piece"),n=t("./character/buffers"),e.exports=o=function(t){function e(t,r,o,i,s,u,a){this.type=t,this.name=r,this.symbol=o,this.skill=i,this.skillRange=s,this.strategy=u,this.maxHealth=a,e.__super__.constructor.call(this,this.type,this.symbol,null),this.buffers=new n,this.items=[],this.skillCount=0,this.health=this.maxHealth}var r;return u(e,t),r={HERO:0},e.prototype.getSkill=function(){return this.skill},e.prototype.getStrategy=function(){return this.strategy},e.prototype.addSkillCount=function(){return this.skillCount+=1},e.prototype.getSkillCount=function(){return this.skillCount},e.prototype.getSkillRange=function(){return this.skillRange},e.prototype.damage=function(t){var e;return e=Math.max(0,this.buffers.diffence(t)),this.health-=e,e},e.prototype.heal=function(t){return this.health=Math.min(this.maxHealth,this.health+t)},e.prototype.cure=function(t){},e.prototype.isDead=function(){return this.health<=0},e.prototype.isHero=function(){return this.type===r.HERO},e.prototype.isHealthy=function(){return this.health===this.maxHealth},e.prototype.addItem=function(t){return this.items.push(t)},e.prototype.getItems=function(){return this.items},e.prototype.setItems=function(t){return this.items=t},e.prototype.useItem=function(t,e){var r;if(null==e&&(e=this),r=s.findIndex(this.items,function(e){return e===t}),r>=0)return this.items.splice(r,1),t.activate(e);throw new Error("the character doesn't have item "+t)},e.prototype.getHealthString=function(){return this.health+"/"+this.maxHealth},e.prototype.getItemsString=function(){return s.map(this.items,function(t){return t.getSymbol()}).join(",")},e.prototype.getBuffersString=function(){return this.buffers.to_s()},e.prototype.waneBuffers=function(){return this.buffers.wane()},e.prototype.addDiffenceBuffer=function(t,e){return this.buffers.addDiffenceBuffer(t,e)},e}(i)},{"./character/buffers":6,"./piece":18,underscore:36}],5:[function(t,e,r){var n;e.exports=n=function(){function t(t,e,r){this.type=t,this.point=e,this.duration=r}var e;return e={ATTACK:0,DIFFENCE:1},t.createDiffenceBuffer=function(r,n){return new t(e.DIFFENCE,r,n)},t.prototype.isAttackBuffer=function(){return this.type===e.ATTACK},t.prototype.isDiffenceBuffer=function(){return this.type===e.DIFFENCE},t.prototype.isExpired=function(){return this.duration<=0},t.prototype.wane=function(){return this.duration-=1},t.prototype.getPoint=function(){return this.point},t.prototype.getSymbol=function(){switch(this.type){case e.ATTACK:return"A("+this.duration+")";case e.DIFFENCE:return"D("+this.duration+")"}},t}()},{}],6:[function(t,e,r){var n,o,i;i=t("underscore"),n=t("./buffer"),e.exports=o=function(){function t(){this.list=[]}return t.prototype.diffence=function(t){var e;return e=function(t,e){return e.isDiffenceBuffer()?t-=e.getPoint():t},i.inject(this.list,e,t)},t.prototype.addDiffenceBuffer=function(t,e){var r;return r=n.createDiffenceBuffer(t,e),this.list.push(r)},t.prototype.to_s=function(){return i.map(this.list,function(t){return t.getSymbol()}).join(",")},t.prototype.wane=function(){var t,e,r,n,o;for(o=this.list.length-1,n=[],t=e=r=o;e>=0;t=e+=-1)this.list[t].wane(),this.list[t].isExpired()?n.push(this.list.splice(t,1)):n.push(void 0);return n},t}()},{"./buffer":5,underscore:36}],7:[function(t,e,r){var n,o,i,s,u=function(t,e){function r(){this.constructor=t}for(var n in e)a.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},a={}.hasOwnProperty;s=t("underscore"),i=t("./piece_collection"),o=t("./character_factory"),e.exports=n=function(t){function e(){this.list=[]}return u(e,t),e.prototype.getHero=function(){return s.find(this.list,function(t){return t.isHero()})},e.prototype.getEnemies=function(){return s.filter(this.list,function(t){return!t.isHero()})},e.prototype.getCharacters=function(){return this.list},e}(i)},{"./character_factory":8,"./piece_collection":19,underscore:36}],8:[function(t,e,r){var n,o;n=t("./character"),e.exports=o=function(){function t(){}var e,r;return e=[["主人公","H","NOTHING",0,"whim",3],["灰泥緑虫","S","ACID",1,"whim",1],["手甲虫","B","GUARDFORM",0,"guard",2],["葛籠鼠","M","AID",1,"devoted",2],["盲瓜坊","P","TACKLE",1,"traveler",3]],r=[[0,0,0,0,0],[1,1,1,2,2],[2,2,2,2,2],[2,2,2,2,3],[2,2,3,4,4],[4,4,4,4,4]],t.create=function(t){var r,o,i,s,u,a,c;return null==t&&(t=null),c=null!=t?t:Math.floor(Math.random()*e.length),o=e[c][0],a=e[c][1],i=e[c][2],s=e[c][3],u=e[c][4],r=e[c][5],new n(c,o,a,i,s,u,r)},t.createHero=function(){return this.create(0)},t.createEnemy=function(){var t,r;return t=1,r=Math.floor(Math.random()*(e.length-t))+t,this.create(r)},t.createByName=function(t){var r,n,o;for(r=n=0,o=e.length;o>=0?o>n:n>o;r=o>=0?++n:--n)if(t===e[r][0])return this.create(r);throw new Error("unknown character: "+t)},t.setCreateSlot=function(t){return this.slot=r[t]},t.createBySlot=function(){var t;return t=Math.floor(Math.random()*this.slot.length),this.create(this.slot[t])},t}()},{"./character":4}],9:[function(t,e,r){var n,o;o=t("underscore"),e.exports=n=function(){function t(t,e){this.board=t,this.character=e,this.base=this.character.getPosition(),this.hero=this.board.getHero()}var e;return e=["up","down","left","right"],t.prototype.findHero=function(){return this.board.isRoom(this.base)&&this.board.isSameRoom(this.base,this.hero.getPosition())?this.hero:this.getDistance(this.hero)<2?this.hero:null},t.prototype.findNearByDirection=function(t){var r,n;return n=("function"==typeof t.getPosition?t.getPosition():void 0)||t,r=function(t){return function(e){return n.distance(t.base[e]())}}(this),o.min(o.shuffle(e),r)},t.prototype.isNeighbor=function(t){return this.getDistance(t)<2},t.prototype.isWalkable=function(t){return!this.board.isWall(t)},t.prototype.getNearestCharacterInSight=function(){var t;return t=this.getCharactersInSight(),o.isEmpty(t)?void 0:o.min(t,function(t){return function(e){return t.getDistance(e)}}(this))},t.prototype.getCharactersInSight=function(){var t,e;return t=this.board.getCharacters(),e=this.board.isRoom(this.base),o.filter(t,function(t){return function(r){return r===t.character?!1:e?t.board.isSameRoom(t.base,r.getPosition()):1===t.getDistance(r)}}(this))},t.prototype.getDoorsInSight=function(){return this.board.isRoom(this.base)?this.board.getDoors(this.base):[]},t.prototype.getDistance=function(t){return t.getPosition().distance(this.base)},t}()},{underscore:36}],10:[function(t,e,r){var n,o,i=function(t,e){function r(){this.constructor=t}for(var n in e)s.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},s={}.hasOwnProperty;o=t("./piece"),e.exports=n=function(t){function e(t,r,n,o,i,s){this.type=t,this.name=r,this.symbol=n,this.effect=o,this.power=i,this.description=s,e.__super__.constructor.call(this,this.type,this.symbol,null)}return i(e,t),e.prototype.getFullName=function(){return this.name},e.prototype.getDescription=function(){return this.description},e.prototype.activate=function(t){switch(this.effect){case"heal":return t.heal(3);default:throw new Error("unknown effect: "+this.effect)}},e}(o)},{"./piece":18}],11:[function(t,e,r){var n,o,i=function(t,e){function r(){this.constructor=t}for(var n in e)s.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},s={}.hasOwnProperty;o=t("./piece_collection"),e.exports=n=function(t){function e(){return e.__super__.constructor.apply(this,arguments)}return i(e,t),e}(o)},{"./piece_collection":19}],12:[function(t,e,r){var n,o;n=t("./item"),e.exports=o=function(){function t(){}var e;return e=[["potion","p","heal",3,"heal character's health 3 points"],["medicine","m","heal",5,"heal character's health 5 points"]],t.create=function(){var t,r,o,i,s,u;return u=Math.floor(Math.random()*e.length),o=e[u][0],s=e[u][1],r=e[u][2],i=e[u][3],t=e[u][4],new n(u,o,s,r,i,t)},t}()},{"./item":10}],13:[function(t,e,r){var n,o,i,s;s=t("underscore"),o=t("./land/builder"),n=t("utils/array2d"),e.exports=i=function(){function t(){}var e,r,i,u;return u=0,e=1,i=2,r=3,t.createRandom=function(e,r){var n;return n=new t,n._randomize(e,r),n._setExit(),n},t.createHall=function(e,r){var o,i,s,a,c;for(i=new t,i.table=new n(e,r,"a".charCodeAt()),c=i.table.round(),o=0,s=c.length;s>o;o++)a=c[o],i.table.set(a,u);return i},t.prototype.getWidth=function(){return this.table.width},t.prototype.getHeight=function(){return this.table.height},t.prototype.getFreePositions=function(){var t;return t=s.filter(this.table.pairs(),function(t){return function(e){return t.isRoom(e)}}(this)),s.shuffle(t)},t.prototype.isWall=function(t){return this.table.get(t)===u},t.prototype.isDoor=function(t){return this.table.get(t)===e},t.prototype.isExit=function(t){return this.table.get(t)===r},t.prototype.isRoom=function(t){return this.table.get(t)>r},t.prototype.isSameRoom=function(t,e){return this.table.get(t)===this.table.get(e)},t.prototype.getDoors=function(t){var e;return e=this.table.get(t),s.filter(this.table.pairs(),function(t){return function(r){var n,o,i,s;if(!t.isDoor(r))return!1;for(s=["up","right","left","down"],o=0,i=s.length;i>o;o++)if(n=s[o],t.table.get(r[n]())===e)return!0;return!1}}(this))},t.prototype.getSymbol=function(t){switch(this.table.get(t)){case u:return"#";case e:return"|";case i:return" ";case r:return"@";default:return" "}},t.prototype.getSymbolDetail=function(t){var n;switch(n=this.table.get(t)){case u:return"#";case e:return"|";case r:return"@";default:return String.fromCharCode(n)}},t.prototype._setExit=function(){var t,e;return t=s.shuffle(this.table.pairs()),e=s.find(t,function(t){return function(e){return t.isRoom(e)}}(this)),this.table.set(e,r)},t.prototype._randomize=function(t,r){var n,s,a,c,h,f;for(this.table=o.create(t,r),c=this.table.pairs(),h=[],n=0,s=c.length;s>n;n++)switch(a=c[n],f=this.table.get(a)){case 0:h.push(this.table.set(a,u));break;case"|":h.push(this.table.set(a,e));break;case"_":h.push(this.table.set(a,i));break;default:h.push(this.table.set(a,f))}return h},t}()},{"./land/builder":14,underscore:36,"utils/array2d":34}],14:[function(t,e,r){var n,o,i;o=t("utils/array2d"),n=t("./builder/area"),e.exports=i=function(){function t(){}return t.create=function(e,r){var n;return n=new t,n.create(e,r)},t.prototype.create=function(t,e){return this.table=new o(t,e,0),this.area=new n(this.table),this._devide(),this._rotate(),this._devide(),this._rotate(),this._devide(),this._rotate(),this._devide(),this._rotate(),this.area.draw(),this.table},t.prototype._rotate=function(){return this.table=this.table.rotate(),this.area.rotate(this.table)},t.prototype._devide=function(){return this.area.devide()},t.test=function(){var e;return e=t.create(130,30),console.log(e.to_s())},t}()},{"./builder/area":15,"utils/array2d":34}],15:[function(t,e,r){var n,o,i,s,u;u=t("underscore"),s=t("utils/pair"),o=t("./cell"),i=t("./line"),e.exports=n=function(){function t(t,e,n){this.table=t,this.base=e||new s(0,0),this.end=n||new s(this.table.width-1,this.table.height-1),this.children=[],this.roomSymbol=r,r+=1}var e,r;return e=0,r="a".charCodeAt(),t.prototype.draw=function(){var t,r,n,o,i,s,a,c,h;if(u.isEmpty(this.children))for(c=this.base.cover(this.end),n=0,i=c.length;i>n;n++)a=c[n],r=this._onEdge(a)?e:this.roomSymbol,this.table.set(a,r);else for(h=this.children,o=0,s=h.length;s>o;o++)t=h[o],t.draw();return this.table},t.prototype.devide=function(){var e,r,n,a,c,h,f,p,l,d;if(this.end.x-this.base.x<10||this.end.y-this.base.y<5)return null;if(u.isEmpty(this.children))return e=u.random(this.base.x+5,this.end.x-6),r=new s(e,this.base.y),n=new s(e,this.end.y),h=u.random(1,e-this.base.x-4),d=u.random(1,this.end.x-e-4),this.children=[new t(this.table,this.base,n.shift(-h,0)),new t(this.table,r.shift(d,0),this.end),new i(this.table,r.shift(0,2),n.shift(0,-2)),new i(this.table,r.shift(-h,2),r.shift(-1,2)),new i(this.table,n.shift(1,-2),n.shift(d,-2)),new o(this.table,r.shift(-h,2)),new o(this.table,n.shift(d,-2))];for(p=this.children,l=[],c=0,f=p.length;f>c;c++)a=p[c],l.push("function"==typeof a.devide?a.devide():void 0);return l},t.prototype.rotate=function(t){var e,r,n,o,i;for(i=this.children,n=0,o=i.length;o>n;n++)e=i[n],e.rotate(t);return r=this.table.height-1,this._init(t,r-this.base.y,this.base.x,r-this.end.y,this.end.x)},t.prototype._onEdge=function(t){return this.base.x===t.x||this.base.y===t.y||this.end.x===t.x||this.end.y===t.y},t.prototype._init=function(t,e,r,n,o){return this.table=t,this.base=new s(Math.min(e,n),Math.min(r,o)),this.end=new s(Math.max(e,n),Math.max(r,o))},t}()},{"./cell":16,"./line":17,underscore:36,"utils/pair":35}],16:[function(t,e,r){var n,o;o=t("utils/pair"),e.exports=n=function(){function t(t,e){this.table=t,this.position=e}var e;return e="|",t.prototype.draw=function(){return this.table.set(this.position,e)},t.prototype.rotate=function(t){var e;return e=this.table.height-1,this.position=new o(e-this.position.y,this.position.x),this.table=t},t}()},{"utils/pair":35}],17:[function(t,e,r){var n,o,i;i=t("underscore"),o=t("utils/pair"),e.exports=n=function(){function t(t,e,r){this.table=t,this.base=e,this.end=r}var e;return e="_",t.prototype.draw=function(){var t,r,n,o,i;for(o=this.base.cover(this.end),i=[],t=0,r=o.length;r>t;t++)n=o[t],i.push(this.table.set(n,e));return i},t.prototype.rotate=function(t){var e;return e=this.table.height-1,this._init(t,e-this.base.y,this.base.x,e-this.end.y,this.end.x)},t.prototype._init=function(t,e,r,n,i){return this.table=t,this.base=new o(Math.min(e,n),Math.min(r,i)),this.end=new o(Math.max(e,n),Math.max(r,i))},t}()},{underscore:36,"utils/pair":35}],18:[function(t,e,r){var n;e.exports=n=function(){function t(t,r,n){this.type=t,this.symbol=r,this.position=n,e+=1,this.id=e}var e;return e=0,t.prototype.getSymbol=function(){return this.symbol},t.prototype.getId=function(){return this.id},t.prototype.setPosition=function(t){return this.position=t},t.prototype.getPosition=function(){return this.position},t.prototype.getUniqueName=function(){return this.symbol+"("+this.id+")"},t}()},{}],19:[function(t,e,r){var n;e.exports=n=function(){function t(){this.list=[]}return t.prototype.add=function(t){return this.list.push(t),t},t.prototype.remove=function(t){var e,r,n;for(e=r=0,n=this.list.length;n>=0?n>r:r>n;e=n>=0?++r:--r)if(this.list[e]===t)return this.list.splice(e,1)},t.prototype.getByPosition=function(t){var e,r,n,o;for(o=this.list,e=0,r=o.length;r>e;e++)if(n=o[e],n.getPosition().equal(t))return n},t.prototype.getSymbol=function(t){var e;return null!=(e=this.getByPosition(t))?e.getSymbol():void 0},t.prototype.setPositions=function(t){var e,r,n,o;for(o=[],e=r=0,n=this.list.length;n>=0?n>r:r>n;e=n>=0?++r:--r){if(!t[e])throw new Error("position が足りません");o.push(this.list[e].setPosition(t[e]))}return o},t}()},{}],20:[function(t,e,r){var n,o,i,s,u,a,c,h;h=t("models/storage"),n=t("./board"),c=t("./board/land"),i=t("./board/character_collection"),s=t("./board/character_factory"),u=t("./board/item_collection"),a=t("./board/item_factory"),e.exports=o=function(){function t(){}var e,r,o,f;return f=80,e=30,r=5,o=5,t.create=function(){var r,o;return r=h.getDifficulty(),o=new t,o.setupLand(f,e),o.setupCharacters(r),o.setupItems(),new n(o.land,o.characters,o.items,r)},t.createHall=function(t,e){var r,o,s;return s=c.createHall(t,e),r=new i,o=new u,new n(s,r,o)},t.prototype.setupLand=function(t,e){return this.land=c.createRandom(t,e)},t.prototype.setupCharacters=function(t){var e,n,o;for(s.setCreateSlot(t),this.characters=new i,this.characters.add(s.createHero()),e=n=0,o=r;o>=0?o>n:n>o;e=o>=0?++n:--n)this.characters.add(s.createBySlot());return this.characters.setPositions(this.land.getFreePositions())},t.prototype.setupItems=function(){var t,e,r;for(this.items=new u,t=e=0,r=o;r>=0?r>e:e>r;t=r>=0?++e:--e)this.items.add(a.create());return this.items.setPositions(this.land.getFreePositions())},t}()},{"./board":3,"./board/character_collection":7,"./board/character_factory":8,"./board/item_collection":11,"./board/item_factory":12,"./board/land":13,"models/storage":33}],21:[function(t,e,r){var n,o,i=function(t,e){function r(){this.constructor=t}for(var n in e)s.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},s={}.hasOwnProperty;o=t("./command"),e.exports=n=function(t){function e(t,e){this.actor=t,this.target=e}return i(e,t),e.prototype.perform=function(t){return this._attack(t),this.actor.waneBuffers()},e.prototype._attack=function(t){return this.point=this.target.damage(1),this.defeated=this.target.isDead(),this.defeated?t.remove(this.target):void 0},e}(o)},{"./command":22}],22:[function(t,e,r){var n;e.exports=n=function(){function t(){}return t.prototype.perform=function(){throw new Error("cannot perform empty command; override me")},t.prototype.getAction=function(){return this.constructor.name.toLowerCase()},t.prototype.getActor=function(){return this.actor},t.prototype.getTarget=function(){return this.target},t.prototype.getItem=function(){return this.item},t.prototype.getDirection=function(){return this.direction},t.prototype.getPoint=function(){return this.point},t.prototype.getFailedReason=function(){var t;return(null!=(t=this.failed)?t.toString():void 0)||""},t.prototype.isDefeated=function(){return this.defeated},t.prototype.isReached=function(){return this.reached},t.prototype.isGameOver=function(){return this.defeated&&this.target.isHero()},t.prototype.isFailed=function(){return null!=this.failed},t.prototype.toString=function(){var t,e,r,n,o,i;return o="function"==typeof(t=this.getActor()).getUniqueName?t.getUniqueName():void 0,i=this.getAction(),e=(null!=(r=this.getTarget())?r.getUniqueName():void 0)||this.getDirection()||(null!=(n=this.getItem())?n.getFullName():void 0),o+" "+i+" "+e+" "+this.getFailedReason()},t}()},{}],23:[function(t,e,r){e.exports={Attack:t("./attack"),Move:t("./move"),MoveOrAttack:t("./move_or_attack"),UseItem:t("./use_item"),UseSkill:t("./use_skill")}},{"./attack":21,"./move":24,"./move_or_attack":25,"./use_item":26,"./use_skill":27}],24:[function(t,e,r){var n,o,i=function(t,e){function r(){this.constructor=t}for(var n in e)s.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},s={}.hasOwnProperty;n=t("./command"),e.exports=o=function(t){function e(t,e){this.actor=t,this.direction=e}return i(e,t),e.prototype.perform=function(t){var e,r;try{return this._move(t)}catch(r){return e=r,this.failed=e}finally{this.actor.waneBuffers()}},e.prototype._move=function(t){var e,r;return e=this.actor.getPosition(),r=e[this.direction](),t.put(r,this.actor),this.item=t.getItem(r),this.item&&(this.actor.addItem(this.item),t.remove(this.item)),this.reached=t.isExit(r)},e}(n)},{"./command":22}],25:[function(t,e,r){var n,o,i,s,u=function(t,e){function r(){this.constructor=t}for(var n in e)a.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},a={}.hasOwnProperty;i=t("./move"),n=t("./attack"),o=t("./command"),e.exports=s=function(t){function e(t,e){this.actor=t,this.direction=e}return u(e,t),e.prototype.perform=function(t){var e,r,n,o;n=this.actor.getPosition(),o=n[this.direction](),this.target=t.get(o);try{return null!=this.target?this._attack(t):this._move(t)}catch(r){return e=r,this.failed=e}finally{this.actor.waneBuffers()}},e.prototype._attack=n.prototype._attack,e.prototype._move=i.prototype._move,e}(o)},{"./attack":21,"./command":22,"./move":24}],26:[function(t,e,r){var n,o,i=function(t,e){function r(){this.constructor=t}for(var n in e)s.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},s={}.hasOwnProperty;n=t("./command"),e.exports=o=function(t){function e(t,e){this.actor=t,this.item=e}return i(e,t),e.prototype.perform=function(t){return this.actor.useItem(this.item),this.actor.waneBuffers()},e}(n)},{"./command":22}],27:[function(t,e,r){var n,o,i=function(t,e){function r(){this.constructor=t}for(var n in e)s.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},s={}.hasOwnProperty;n=t("./command"),e.exports=o=function(t){function e(t,e){this.actor=t,this.target=e}return i(e,t),e.prototype.perform=function(t){var e,r;try{return this._useSkill(t)}catch(r){return e=r,this.failed=e}finally{this.actor.waneBuffers()}},e.prototype._useSkill=function(t){switch(this.skill=this.actor.getSkill(),this.skill){case"ACID":return;case"GUARDFORM":this.actor.addDiffenceBuffer(1,2);break;case"AID":this._aid();break;case"TACKLE":this._tackle(t);break;default:throw new Error("use unknown skill "+name)}return this.actor.addSkillCount()},e.prototype._aid=function(){if(this.target.isHealthy())throw new Error("He canceled skill, because that is meaningless");if(this.actor.getSkillCount()>2)throw new Error("He doesn't have medicine!");return this.target.heal(3)},e.prototype._tackle=function(t){var e,r,n,o,i,s,u,a,c;if(i=this.actor.getPosition(),s=this.target.getPosition(),i.distance(s)>1)throw new Error("He cannot reach the target");for(u=["up","down","left","right"],a=[],n=0,o=u.length;o>n;n++)r=u[n],c=i[r](),c.equal(s)?(e=s[r](),t.isWall(e)?a.push(this.target.damage(1)):a.push(t.put(e,this.target))):a.push(void 0);return a},e}(n)},{"./command":22}],28:[function(t,e,r){var n,o,i;i=t("underscore"),o=t("./strategy"),e.exports=n=function(){function t(){this.hand=[],this.strategies={}}return t.prototype.assign=function(t){return t instanceof Array?this.hand=this.hand.concat(t):this.hand.push(t)},t.prototype.characters=function(){return i.filter(this.hand,function(t){return!t.isDead()})},t.prototype.command=function(t,e){return this._pickStrategy(t).createCommand(e)},t.prototype.clearHand=function(){return this.hand=[],this.strategies={}},t.prototype._pickStrategy=function(t){var e,r;return(e=this.strategies)[r=t.getId()]||(e[r]=new o(t))},t}()},{"./strategy":32,underscore:36}],29:[function(t,e,r){var n,o,i,s,u=function(t,e){function r(){this.constructor=t}for(var n in e)a.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},a={}.hasOwnProperty;s=t("underscore"),i=t("./score_keeper"),o=t("./base"),e.exports=n=function(t){function e(){this.scoreKeeper=new i,this.hand=[],this.nextCommand=null}return u(e,t),e.prototype.getHero=function(){return this.hand[0]},e.prototype.command=function(t,e){return this.nextCommand},e.prototype.setCommand=function(t){return this.nextCommand=t},e.prototype.setScore=function(t){return this.scoreKeeper.setScore(t)},e.prototype.getScore=function(){return this.scoreKeeper.getScore()},e.prototype.addScoreByCharacter=function(t){return this.scoreKeeper.addScoreByCharacter(t)},e.prototype.addScoreByBoard=function(t){return this.scoreKeeper.addScoreByBoard(t)},e}(o)},{"./base":28,"./score_keeper":31,underscore:36}],30:[function(t,e,r){e.exports={Human:t("./human"),Computer:t("./base")}},{"./base":28,"./human":29}],31:[function(t,e,r){var n;e.exports=n=function(){function t(){this.score=0}var e;return e={H:0,S:10,B:15,M:20,P:25},t.prototype.addScoreByCharacter=function(t){var r;return r=e[t.getSymbol()],this.score+=r},t.prototype.addScoreByBoard=function(t){return this.score+=100*t},t.prototype.getScore=function(){return this.score},t.prototype.setScore=function(t){return this.score=t},t}()},{}],32:[function(t,e,r){var n,o,i;i=t("underscore"),n=t("../command/"),e.exports=o=function(){function t(t){this.character=t,this.type=this.character.getStrategy(),this.milestone=null,this.prevPosition=null}var e,r;return r=.25,e=["up","down","left","right"],t.prototype.createCommand=function(t){switch(this.inspector=t,this.type){case"whim":return this.whim();case"guard":return this.guard();case"devoted":return this.devoted();case"traveler":return this.traveler();default:throw new Error("unknown strategy type #{@type}")}},t.prototype.whim=function(){var t;return t=this.inspector.findHero(),t&&this.inspector.isNeighbor(t)?this._attackOrUseSkill():this._randomMove()},t.prototype.guard=function(){return this.inspector.findHero()?this._attackOrUseSkill():this._randomMove()},t.prototype.devoted=function(){var t;return t=this.inspector.getNearestCharacterInSight(),null==t?this._randomMove():this.inspector.getDistance(t)>1?this._approach(t):t===this.inspector.findHero()?this._attack(t):this._useSkill(t)},t.prototype.traveler=function(){var t,r,n,o,s,u;if(this.character.getPosition().equal(this.milestone)&&(this.milestone=null),n=this.inspector.findHero(),r=this.inspector.getDoorsInSight(),n)return this._attackOrUseSkill();if(null!=this.milestone)return this._approach(this.milestone);if(r.length>0)return this.milestone=i.sample(r),this._approach(this.milestone);for(o=0,s=e.length;s>o;o++)if(t=e[o],u=this.character.getPosition()[t](),!u.equal(this.prevPosition)&&this.inspector.isWalkable(u))return this._approach(u)},t.prototype._attackOrUseSkill=function(t){return Math.random()>r?this._attack():this._useSkill(t)},t.prototype._approach=function(t){var e;return t||(t=this.inspector.findHero()),e=this.inspector.findNearByDirection(t),this.prevPosition=this.character.getPosition(),new n.MoveOrAttack(this.character,e)},t.prototype._attack=function(t){return this._approach(t)},t.prototype._useSkill=function(t){switch(this.character.getSkillRange()){case 1:return t||(t=this.inspector.findHero()),new n.UseSkill(this.character,t);case 0:return new n.UseSkill(this.character,this.character);default:throw new Error("cannot deal the skill range: #{@character.getSkillRange()}")}},t.prototype._randomMove=function(){var t;return t=i.sample(e),new n.Move(this.character,t)},t}()},{"../command/":23,underscore:36}],33:[function(t,e,r){var n;n=function(){function t(){this.difficulty=1,this.score=0}return t.prototype.getDifficulty=function(){return this.difficulty},t.prototype.setDifficulty=function(t){return this.difficulty=t},t.prototype.getScore=function(){return this.score},t.prototype.setScore=function(t){return this.score=t},t}(),e.exports=new n},{}],34:[function(t,e,r){var n,o,i,s=function(t,e){function r(){this.constructor=t}for(var n in e)u.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},u={}.hasOwnProperty;i=t("./pair"),o=function(t){function e(t,e){this.message="out of range "+t+", "+e}return s(e,t),e}(Error),e.exports=n=function(){function t(t,e,r){var n,o,i,s,u,a;for(this.width=t,this.height=e,null==r&&(r=null),this.rows=[],a=n=0,i=this.height;i>=0?i>n:n>i;a=i>=0?++n:--n)for(this.rows[a]=[],u=o=0,s=this.width;s>=0?s>o:o>s;u=s>=0?++o:--o)this.rows[a][u]=r}return t.OutOfBoundsError=o,t.create=function(e){var r,n,o,i,s,u,a,c,h;for(n=e.length,a=e[0].length,r=new t(a,n),h=o=0,s=n;s>=0?s>o:o>s;h=s>=0?++o:--o)for(c=i=0,u=a;u>=0?u>i:i>u;c=u>=0?++i:--i)r.set(c,h,e[h][c]);return r},t.prototype.set=function(t,e,r){return t instanceof i&&(r=e,e=t.y,t=t.x),this._check(t,e),this.rows[e][t]=r},t.prototype.get=function(t,e){return t instanceof i&&(e=t.y,t=t.x),this._check(t,e),this.rows[e][t]},t.prototype.pairs=function(){var t,e,r,n,o,s,u;for(t=[],u=e=0,n=this.height;n>=0?n>e:e>n;u=n>=0?++e:--e)for(s=r=0,o=this.width;o>=0?o>r:r>o;s=o>=0?++r:--r)t.push(new i(s,u));return t},t.prototype.each=function(t){var e,r,n,o,i,s;for(s=e=0,n=this.height;n>=0?n>e:e>n;s=n>=0?++e:--e)for(i=r=0,o=this.width;o>=0?o>r:r>o;i=o>=0?++r:--r)t(i,s,this.rows[s][i]);return this},t.prototype.round=function(){var t,e,r,n,o,s,u;for(t=[],u=e=0,n=this.height;n>=0?n>e:e>n;u=n>=0?++e:--e)for(s=r=0,o=this.width;o>=0?o>r:r>o;s=o>=0?++r:--r)(0===s||0===u||s===this.width-1||u===this.height-1)&&t.push(new i(s,u));return t},t.prototype.rotate=function(){var e,r,n,o,i,s,u;for(e=new t(this.height,this.width),u=r=0,
o=this.height;o>=0?o>r:r>o;u=o>=0?++r:--r)for(s=n=0,i=this.width;i>=0?i>n:n>i;s=i>=0?++n:--n)e.set(this.height-1-u,s,this.get(s,u));return e},t.prototype.clear=function(t){var e,r,n,o,i;for(null==t&&(t=null),o=this.pairs(),i=[],e=0,r=o.length;r>e;e++)n=o[e],i.push(a.set(n,t));return i},t.prototype.to_s=function(){return this.rows.join("\n").replace(/,/g,"")},t.prototype.toString=function(){return this.to_s()},t.prototype._check=function(t,e){if(0>t||0>e||e>=this.height||t>=this.width)throw new o(t,e)},t}()},{"./pair":35}],35:[function(t,e,r){var n;e.exports=n=function(){function t(t,e){this.x=t,this.y=e}return t.prototype.equal=function(t){return t&&t.x===this.x&&t.y===this.y},t.prototype.shift=function(e,r){return new t(this.x+e,this.y+r)},t.prototype.times=function(e){return new t(this.x*e,this.y*e)},t.prototype.scalar=function(t){return this.times(t)},t.prototype.up=function(e){return null==e&&(e=1),new t(this.x,this.y-e)},t.prototype.down=function(e){return null==e&&(e=1),new t(this.x,this.y+e)},t.prototype.left=function(e){return null==e&&(e=1),new t(this.x-e,this.y)},t.prototype.right=function(e){return null==e&&(e=1),new t(this.x+e,this.y)},t.prototype.distance=function(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)},t.prototype.cover=function(e){var r,n,o,i,s,u,a,c,h;for(r=[],c=n=i=this.x,s=e.x;s>=i?s>=n:n>=s;c=s>=i?++n:--n)for(h=o=u=this.y,a=e.y;a>=u?a>=o:o>=a;h=a>=u?++o:--o)r.push(new t(c,h));return r},t.prototype.where=function(t){var e;return e=null,this.x===t.x?this.y>t.y?e="up":this.y<t.y&&(e="down"):this.y===t.y&&(this.x>t.x?e="left":this.x<t.x&&(e="right")),e},t.prototype.to_s=function(){return this.x+","+this.y},t.prototype.toString=function(){return this.to_s()},t}()},{}],36:[function(t,e,r){(function(){function t(t){function e(e,r,n,o,i,s){for(;i>=0&&s>i;i+=t){var u=o?o[i]:i;n=r(n,e[u],u,e)}return n}return function(r,n,o,i){n=_(n,i,4);var s=!P(r)&&w.keys(r),u=(s||r).length,a=t>0?0:u-1;return arguments.length<3&&(o=r[s?s[a]:a],a+=t),e(r,n,o,s,a,u)}}function n(t){return function(e,r,n){r=x(r,n);for(var o=D(e),i=t>0?0:o-1;i>=0&&o>i;i+=t)if(r(e[i],i,e))return i;return-1}}function o(t,e,r){return function(n,o,i){var s=0,u=D(n);if("number"==typeof i)t>0?s=i>=0?i:Math.max(i+u,s):u=i>=0?Math.min(i+1,u):i+u+1;else if(r&&i&&u)return i=r(n,o),n[i]===o?i:-1;if(o!==o)return i=e(p.call(n,s,u),w.isNaN),i>=0?i+s:-1;for(i=t>0?s:u-1;i>=0&&u>i;i+=t)if(n[i]===o)return i;return-1}}function i(t,e){var r=M.length,n=t.constructor,o=w.isFunction(n)&&n.prototype||c,i="constructor";for(w.has(t,i)&&!w.contains(e,i)&&e.push(i);r--;)i=M[r],i in t&&t[i]!==o[i]&&!w.contains(e,i)&&e.push(i)}var s=this,u=s._,a=Array.prototype,c=Object.prototype,h=Function.prototype,f=a.push,p=a.slice,l=c.toString,d=c.hasOwnProperty,y=Array.isArray,g=Object.keys,m=h.bind,v=Object.create,b=function(){},w=function(t){return t instanceof w?t:this instanceof w?void(this._wrapped=t):new w(t)};"undefined"!=typeof r?("undefined"!=typeof e&&e.exports&&(r=e.exports=w),r._=w):s._=w,w.VERSION="1.8.3";var _=function(t,e,r){if(void 0===e)return t;switch(null==r?3:r){case 1:return function(r){return t.call(e,r)};case 2:return function(r,n){return t.call(e,r,n)};case 3:return function(r,n,o){return t.call(e,r,n,o)};case 4:return function(r,n,o,i){return t.call(e,r,n,o,i)}}return function(){return t.apply(e,arguments)}},x=function(t,e,r){return null==t?w.identity:w.isFunction(t)?_(t,e,r):w.isObject(t)?w.matcher(t):w.property(t)};w.iteratee=function(t,e){return x(t,e,1/0)};var S=function(t,e){return function(r){var n=arguments.length;if(2>n||null==r)return r;for(var o=1;n>o;o++)for(var i=arguments[o],s=t(i),u=s.length,a=0;u>a;a++){var c=s[a];e&&void 0!==r[c]||(r[c]=i[c])}return r}},k=function(t){if(!w.isObject(t))return{};if(v)return v(t);b.prototype=t;var e=new b;return b.prototype=null,e},E=function(t){return function(e){return null==e?void 0:e[t]}},A=Math.pow(2,53)-1,D=E("length"),P=function(t){var e=D(t);return"number"==typeof e&&e>=0&&A>=e};w.each=w.forEach=function(t,e,r){e=_(e,r);var n,o;if(P(t))for(n=0,o=t.length;o>n;n++)e(t[n],n,t);else{var i=w.keys(t);for(n=0,o=i.length;o>n;n++)e(t[i[n]],i[n],t)}return t},w.map=w.collect=function(t,e,r){e=x(e,r);for(var n=!P(t)&&w.keys(t),o=(n||t).length,i=Array(o),s=0;o>s;s++){var u=n?n[s]:s;i[s]=e(t[u],u,t)}return i},w.reduce=w.foldl=w.inject=t(1),w.reduceRight=w.foldr=t(-1),w.find=w.detect=function(t,e,r){var n;return n=P(t)?w.findIndex(t,e,r):w.findKey(t,e,r),void 0!==n&&-1!==n?t[n]:void 0},w.filter=w.select=function(t,e,r){var n=[];return e=x(e,r),w.each(t,function(t,r,o){e(t,r,o)&&n.push(t)}),n},w.reject=function(t,e,r){return w.filter(t,w.negate(x(e)),r)},w.every=w.all=function(t,e,r){e=x(e,r);for(var n=!P(t)&&w.keys(t),o=(n||t).length,i=0;o>i;i++){var s=n?n[i]:i;if(!e(t[s],s,t))return!1}return!0},w.some=w.any=function(t,e,r){e=x(e,r);for(var n=!P(t)&&w.keys(t),o=(n||t).length,i=0;o>i;i++){var s=n?n[i]:i;if(e(t[s],s,t))return!0}return!1},w.contains=w.includes=w.include=function(t,e,r,n){return P(t)||(t=w.values(t)),("number"!=typeof r||n)&&(r=0),w.indexOf(t,e,r)>=0},w.invoke=function(t,e){var r=p.call(arguments,2),n=w.isFunction(e);return w.map(t,function(t){var o=n?e:t[e];return null==o?o:o.apply(t,r)})},w.pluck=function(t,e){return w.map(t,w.property(e))},w.where=function(t,e){return w.filter(t,w.matcher(e))},w.findWhere=function(t,e){return w.find(t,w.matcher(e))},w.max=function(t,e,r){var n,o,i=-(1/0),s=-(1/0);if(null==e&&null!=t){t=P(t)?t:w.values(t);for(var u=0,a=t.length;a>u;u++)n=t[u],n>i&&(i=n)}else e=x(e,r),w.each(t,function(t,r,n){o=e(t,r,n),(o>s||o===-(1/0)&&i===-(1/0))&&(i=t,s=o)});return i},w.min=function(t,e,r){var n,o,i=1/0,s=1/0;if(null==e&&null!=t){t=P(t)?t:w.values(t);for(var u=0,a=t.length;a>u;u++)n=t[u],i>n&&(i=n)}else e=x(e,r),w.each(t,function(t,r,n){o=e(t,r,n),(s>o||o===1/0&&i===1/0)&&(i=t,s=o)});return i},w.shuffle=function(t){for(var e,r=P(t)?t:w.values(t),n=r.length,o=Array(n),i=0;n>i;i++)e=w.random(0,i),e!==i&&(o[i]=o[e]),o[e]=r[i];return o},w.sample=function(t,e,r){return null==e||r?(P(t)||(t=w.values(t)),t[w.random(t.length-1)]):w.shuffle(t).slice(0,Math.max(0,e))},w.sortBy=function(t,e,r){return e=x(e,r),w.pluck(w.map(t,function(t,r,n){return{value:t,index:r,criteria:e(t,r,n)}}).sort(function(t,e){var r=t.criteria,n=e.criteria;if(r!==n){if(r>n||void 0===r)return 1;if(n>r||void 0===n)return-1}return t.index-e.index}),"value")};var O=function(t){return function(e,r,n){var o={};return r=x(r,n),w.each(e,function(n,i){var s=r(n,i,e);t(o,n,s)}),o}};w.groupBy=O(function(t,e,r){w.has(t,r)?t[r].push(e):t[r]=[e]}),w.indexBy=O(function(t,e,r){t[r]=e}),w.countBy=O(function(t,e,r){w.has(t,r)?t[r]++:t[r]=1}),w.toArray=function(t){return t?w.isArray(t)?p.call(t):P(t)?w.map(t,w.identity):w.values(t):[]},w.size=function(t){return null==t?0:P(t)?t.length:w.keys(t).length},w.partition=function(t,e,r){e=x(e,r);var n=[],o=[];return w.each(t,function(t,r,i){(e(t,r,i)?n:o).push(t)}),[n,o]},w.first=w.head=w.take=function(t,e,r){return null!=t?null==e||r?t[0]:w.initial(t,t.length-e):void 0},w.initial=function(t,e,r){return p.call(t,0,Math.max(0,t.length-(null==e||r?1:e)))},w.last=function(t,e,r){return null!=t?null==e||r?t[t.length-1]:w.rest(t,Math.max(0,t.length-e)):void 0},w.rest=w.tail=w.drop=function(t,e,r){return p.call(t,null==e||r?1:e)},w.compact=function(t){return w.filter(t,w.identity)};var B=function(t,e,r,n){for(var o=[],i=0,s=n||0,u=D(t);u>s;s++){var a=t[s];if(P(a)&&(w.isArray(a)||w.isArguments(a))){e||(a=B(a,e,r));var c=0,h=a.length;for(o.length+=h;h>c;)o[i++]=a[c++]}else r||(o[i++]=a)}return o};w.flatten=function(t,e){return B(t,e,!1)},w.without=function(t){return w.difference(t,p.call(arguments,1))},w.uniq=w.unique=function(t,e,r,n){w.isBoolean(e)||(n=r,r=e,e=!1),null!=r&&(r=x(r,n));for(var o=[],i=[],s=0,u=D(t);u>s;s++){var a=t[s],c=r?r(a,s,t):a;e?(s&&i===c||o.push(a),i=c):r?w.contains(i,c)||(i.push(c),o.push(a)):w.contains(o,a)||o.push(a)}return o},w.union=function(){return w.uniq(B(arguments,!0,!0))},w.intersection=function(t){for(var e=[],r=arguments.length,n=0,o=D(t);o>n;n++){var i=t[n];if(!w.contains(e,i)){for(var s=1;r>s&&w.contains(arguments[s],i);s++);s===r&&e.push(i)}}return e},w.difference=function(t){var e=B(arguments,!0,!0,1);return w.filter(t,function(t){return!w.contains(e,t)})},w.zip=function(){return w.unzip(arguments)},w.unzip=function(t){for(var e=t&&w.max(t,D).length||0,r=Array(e),n=0;e>n;n++)r[n]=w.pluck(t,n);return r},w.object=function(t,e){for(var r={},n=0,o=D(t);o>n;n++)e?r[t[n]]=e[n]:r[t[n][0]]=t[n][1];return r},w.findIndex=n(1),w.findLastIndex=n(-1),w.sortedIndex=function(t,e,r,n){r=x(r,n,1);for(var o=r(e),i=0,s=D(t);s>i;){var u=Math.floor((i+s)/2);r(t[u])<o?i=u+1:s=u}return i},w.indexOf=o(1,w.findIndex,w.sortedIndex),w.lastIndexOf=o(-1,w.findLastIndex),w.range=function(t,e,r){null==e&&(e=t||0,t=0),r=r||1;for(var n=Math.max(Math.ceil((e-t)/r),0),o=Array(n),i=0;n>i;i++,t+=r)o[i]=t;return o};var C=function(t,e,r,n,o){if(!(n instanceof e))return t.apply(r,o);var i=k(t.prototype),s=t.apply(i,o);return w.isObject(s)?s:i};w.bind=function(t,e){if(m&&t.bind===m)return m.apply(t,p.call(arguments,1));if(!w.isFunction(t))throw new TypeError("Bind must be called on a function");var r=p.call(arguments,2),n=function(){return C(t,n,e,this,r.concat(p.call(arguments)))};return n},w.partial=function(t){var e=p.call(arguments,1),r=function(){for(var n=0,o=e.length,i=Array(o),s=0;o>s;s++)i[s]=e[s]===w?arguments[n++]:e[s];for(;n<arguments.length;)i.push(arguments[n++]);return C(t,r,this,this,i)};return r},w.bindAll=function(t){var e,r,n=arguments.length;if(1>=n)throw new Error("bindAll must be passed function names");for(e=1;n>e;e++)r=arguments[e],t[r]=w.bind(t[r],t);return t},w.memoize=function(t,e){var r=function(n){var o=r.cache,i=""+(e?e.apply(this,arguments):n);return w.has(o,i)||(o[i]=t.apply(this,arguments)),o[i]};return r.cache={},r},w.delay=function(t,e){var r=p.call(arguments,2);return setTimeout(function(){return t.apply(null,r)},e)},w.defer=w.partial(w.delay,w,1),w.throttle=function(t,e,r){var n,o,i,s=null,u=0;r||(r={});var a=function(){u=r.leading===!1?0:w.now(),s=null,i=t.apply(n,o),s||(n=o=null)};return function(){var c=w.now();u||r.leading!==!1||(u=c);var h=e-(c-u);return n=this,o=arguments,0>=h||h>e?(s&&(clearTimeout(s),s=null),u=c,i=t.apply(n,o),s||(n=o=null)):s||r.trailing===!1||(s=setTimeout(a,h)),i}},w.debounce=function(t,e,r){var n,o,i,s,u,a=function(){var c=w.now()-s;e>c&&c>=0?n=setTimeout(a,e-c):(n=null,r||(u=t.apply(i,o),n||(i=o=null)))};return function(){i=this,o=arguments,s=w.now();var c=r&&!n;return n||(n=setTimeout(a,e)),c&&(u=t.apply(i,o),i=o=null),u}},w.wrap=function(t,e){return w.partial(e,t)},w.negate=function(t){return function(){return!t.apply(this,arguments)}},w.compose=function(){var t=arguments,e=t.length-1;return function(){for(var r=e,n=t[e].apply(this,arguments);r--;)n=t[r].call(this,n);return n}},w.after=function(t,e){return function(){return--t<1?e.apply(this,arguments):void 0}},w.before=function(t,e){var r;return function(){return--t>0&&(r=e.apply(this,arguments)),1>=t&&(e=null),r}},w.once=w.partial(w.before,2);var I=!{toString:null}.propertyIsEnumerable("toString"),M=["valueOf","isPrototypeOf","toString","propertyIsEnumerable","hasOwnProperty","toLocaleString"];w.keys=function(t){if(!w.isObject(t))return[];if(g)return g(t);var e=[];for(var r in t)w.has(t,r)&&e.push(r);return I&&i(t,e),e},w.allKeys=function(t){if(!w.isObject(t))return[];var e=[];for(var r in t)e.push(r);return I&&i(t,e),e},w.values=function(t){for(var e=w.keys(t),r=e.length,n=Array(r),o=0;r>o;o++)n[o]=t[e[o]];return n},w.mapObject=function(t,e,r){e=x(e,r);for(var n,o=w.keys(t),i=o.length,s={},u=0;i>u;u++)n=o[u],s[n]=e(t[n],n,t);return s},w.pairs=function(t){for(var e=w.keys(t),r=e.length,n=Array(r),o=0;r>o;o++)n[o]=[e[o],t[e[o]]];return n},w.invert=function(t){for(var e={},r=w.keys(t),n=0,o=r.length;o>n;n++)e[t[r[n]]]=r[n];return e},w.functions=w.methods=function(t){var e=[];for(var r in t)w.isFunction(t[r])&&e.push(r);return e.sort()},w.extend=S(w.allKeys),w.extendOwn=w.assign=S(w.keys),w.findKey=function(t,e,r){e=x(e,r);for(var n,o=w.keys(t),i=0,s=o.length;s>i;i++)if(n=o[i],e(t[n],n,t))return n},w.pick=function(t,e,r){var n,o,i={},s=t;if(null==s)return i;w.isFunction(e)?(o=w.allKeys(s),n=_(e,r)):(o=B(arguments,!1,!1,1),n=function(t,e,r){return e in r},s=Object(s));for(var u=0,a=o.length;a>u;u++){var c=o[u],h=s[c];n(h,c,s)&&(i[c]=h)}return i},w.omit=function(t,e,r){if(w.isFunction(e))e=w.negate(e);else{var n=w.map(B(arguments,!1,!1,1),String);e=function(t,e){return!w.contains(n,e)}}return w.pick(t,e,r)},w.defaults=S(w.allKeys,!0),w.create=function(t,e){var r=k(t);return e&&w.extendOwn(r,e),r},w.clone=function(t){return w.isObject(t)?w.isArray(t)?t.slice():w.extend({},t):t},w.tap=function(t,e){return e(t),t},w.isMatch=function(t,e){var r=w.keys(e),n=r.length;if(null==t)return!n;for(var o=Object(t),i=0;n>i;i++){var s=r[i];if(e[s]!==o[s]||!(s in o))return!1}return!0};var H=function(t,e,r,n){if(t===e)return 0!==t||1/t===1/e;if(null==t||null==e)return t===e;t instanceof w&&(t=t._wrapped),e instanceof w&&(e=e._wrapped);var o=l.call(t);if(o!==l.call(e))return!1;switch(o){case"[object RegExp]":case"[object String]":return""+t==""+e;case"[object Number]":return+t!==+t?+e!==+e:0===+t?1/+t===1/e:+t===+e;case"[object Date]":case"[object Boolean]":return+t===+e}var i="[object Array]"===o;if(!i){if("object"!=typeof t||"object"!=typeof e)return!1;var s=t.constructor,u=e.constructor;if(s!==u&&!(w.isFunction(s)&&s instanceof s&&w.isFunction(u)&&u instanceof u)&&"constructor"in t&&"constructor"in e)return!1}r=r||[],n=n||[];for(var a=r.length;a--;)if(r[a]===t)return n[a]===e;if(r.push(t),n.push(e),i){if(a=t.length,a!==e.length)return!1;for(;a--;)if(!H(t[a],e[a],r,n))return!1}else{var c,h=w.keys(t);if(a=h.length,w.keys(e).length!==a)return!1;for(;a--;)if(c=h[a],!w.has(e,c)||!H(t[c],e[c],r,n))return!1}return r.pop(),n.pop(),!0};w.isEqual=function(t,e){return H(t,e)},w.isEmpty=function(t){return null==t?!0:P(t)&&(w.isArray(t)||w.isString(t)||w.isArguments(t))?0===t.length:0===w.keys(t).length},w.isElement=function(t){return!(!t||1!==t.nodeType)},w.isArray=y||function(t){return"[object Array]"===l.call(t)},w.isObject=function(t){var e=typeof t;return"function"===e||"object"===e&&!!t},w.each(["Arguments","Function","String","Number","Date","RegExp","Error"],function(t){w["is"+t]=function(e){return l.call(e)==="[object "+t+"]"}}),w.isArguments(arguments)||(w.isArguments=function(t){return w.has(t,"callee")}),"function"!=typeof/./&&"object"!=typeof Int8Array&&(w.isFunction=function(t){return"function"==typeof t||!1}),w.isFinite=function(t){return isFinite(t)&&!isNaN(parseFloat(t))},w.isNaN=function(t){return w.isNumber(t)&&t!==+t},w.isBoolean=function(t){return t===!0||t===!1||"[object Boolean]"===l.call(t)},w.isNull=function(t){return null===t},w.isUndefined=function(t){return void 0===t},w.has=function(t,e){return null!=t&&d.call(t,e)},w.noConflict=function(){return s._=u,this},w.identity=function(t){return t},w.constant=function(t){return function(){return t}},w.noop=function(){},w.property=E,w.propertyOf=function(t){return null==t?function(){}:function(e){return t[e]}},w.matcher=w.matches=function(t){return t=w.extendOwn({},t),function(e){return w.isMatch(e,t)}},w.times=function(t,e,r){var n=Array(Math.max(0,t));e=_(e,r,1);for(var o=0;t>o;o++)n[o]=e(o);return n},w.random=function(t,e){return null==e&&(e=t,t=0),t+Math.floor(Math.random()*(e-t+1))},w.now=Date.now||function(){return(new Date).getTime()};var j={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},F=w.invert(j),N=function(t){var e=function(e){return t[e]},r="(?:"+w.keys(t).join("|")+")",n=RegExp(r),o=RegExp(r,"g");return function(t){return t=null==t?"":""+t,n.test(t)?t.replace(o,e):t}};w.escape=N(j),w.unescape=N(F),w.result=function(t,e,r){var n=null==t?void 0:t[e];return void 0===n&&(n=r),w.isFunction(n)?n.call(t):n};var R=0;w.uniqueId=function(t){var e=++R+"";return t?t+e:e},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var T=/(.)^/,L={"'":"'","\\":"\\","\r":"r","\n":"n","\u2028":"u2028","\u2029":"u2029"},q=/\\|'|\r|\n|\u2028|\u2029/g,U=function(t){return"\\"+L[t]};w.template=function(t,e,r){!e&&r&&(e=r),e=w.defaults({},e,w.templateSettings);var n=RegExp([(e.escape||T).source,(e.interpolate||T).source,(e.evaluate||T).source].join("|")+"|$","g"),o=0,i="__p+='";t.replace(n,function(e,r,n,s,u){return i+=t.slice(o,u).replace(q,U),o=u+e.length,r?i+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'":n?i+="'+\n((__t=("+n+"))==null?'':__t)+\n'":s&&(i+="';\n"+s+"\n__p+='"),e}),i+="';\n",e.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+i+"return __p;\n";try{var s=new Function(e.variable||"obj","_",i)}catch(u){throw u.source=i,u}var a=function(t){return s.call(this,t,w)},c=e.variable||"obj";return a.source="function("+c+"){\n"+i+"}",a},w.chain=function(t){var e=w(t);return e._chain=!0,e};var K=function(t,e){return t._chain?w(e).chain():e};w.mixin=function(t){w.each(w.functions(t),function(e){var r=w[e]=t[e];w.prototype[e]=function(){var t=[this._wrapped];return f.apply(t,arguments),K(this,r.apply(w,t))}})},w.mixin(w),w.each(["pop","push","reverse","shift","sort","splice","unshift"],function(t){var e=a[t];w.prototype[t]=function(){var r=this._wrapped;return e.apply(r,arguments),"shift"!==t&&"splice"!==t||0!==r.length||delete r[0],K(this,r)}}),w.each(["concat","join","slice"],function(t){var e=a[t];w.prototype[t]=function(){return K(this,e.apply(this._wrapped,arguments))}}),w.prototype.value=function(){return this._wrapped},w.prototype.valueOf=w.prototype.toJSON=w.prototype.value,w.prototype.toString=function(){return""+this._wrapped},"function"==typeof define&&define.amd&&define("underscore",[],function(){return w})}).call(this)},{}]},{},[1]);